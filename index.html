<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kyle's DreamJourney Tweaker</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a2e; 
            color: #e0e0e0; 
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.6;
        }
        .page-wrapper { 
            width: 100%;
            max-width: 1100px; 
        }
        .main-container {
            display: flex;
            flex-direction: row; 
            gap: 30px;
            width: 100%;
            background-color: #24243e; 
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 25px 35px 35px 35px;
            border: 1px solid #3a3a5a;
            margin-bottom: 30px; 
        }
        .controls-column {
            flex: 1; 
            min-width: 300px; 
            max-width: 400px; 
        }
        .profile-column {
            flex: 1.5; 
            min-width: 350px; 
        }

        h1 {
            text-align: center;
            color: #9bf6ff; 
            margin-bottom: 10px; 
            font-size: 1.9em;
            font-weight: 600;
        }
        .disclaimer-note {
            text-align: center;
            color: #b0b0b0;
            font-size: 0.85em;
            font-style: italic;
            margin-bottom: 25px;
            max-width: 600px; 
            margin-left: auto;
            margin-right: auto;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 28px; 
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        .control-group .label-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .main-label { 
            font-weight: 600;
            font-size: 1.1em; 
            color: #c5c6c7;
        }
        .qualitative-value { 
             font-weight: normal;
             font-style: italic;
             font-size: 0.9em;
             color: #a9a9a9;
        }
        .control-group input[type="range"] {
            width: 100%;
            cursor: pointer;
            accent-color: #6a0dad; 
            background: #3a3a5a; 
            border-radius: 5px;
            height: 8px;
            -webkit-appearance: none; 
            appearance: none;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #6a0dad; 
            border-radius: 50%;
            border: 2px solid #1a1a2e; 
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .control-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #6a0dad; 
            border-radius: 50%;
            border: 2px solid #1a1a2e;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
         .control-group input[type="range"]::-webkit-slider-thumb:hover {
            background: #800080; 
        }
        .control-group input[type="range"]::-moz-range-thumb:hover {
            background: #800080; 
        }

        .numerical-value-box {
            background-color: #1e1e36; 
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.95em;
            text-align: center;
            margin-top: 10px; 
            border: 1px solid #3a3a5a;
            width: 80px; 
            margin-left: auto;
            margin-right: auto; 
            transition: background-color 0.3s ease, color 0.3s ease; 
        }
        .numerical-value-box.recommendation-warning { 
            background-color: #FFD700; 
            color: #332e00; 
        }
        .numerical-value-box.critical-warning { 
            color: #1a1a2e; 
            background-color: #ff6b6b; 
            font-weight: bold;
        }
        .slider-ends {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em; 
            color: #8c8c8c; 
            margin-top: 6px;
        }
        .setting-description {
            font-size: 0.85em;
            color: #b0b0b0;
            margin-top: 8px;
            line-height: 1.4;
            text-align: left;
        }
        
        .action-buttons button { 
            background-color: #6a0dad; 
            color: #e0e0e0;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: background-color 0.2s ease;
            display: block;
            width: 80%; 
            max-width: 250px; 
            margin: 15px auto 0 auto; 
        }
        .action-buttons button:hover {
            background-color: #800080; 
        }
        #toggle-guide-button { 
            margin-top: 10px; 
        }


        .description-box {
            padding: 25px;
            background-color: #2a2a4a; 
            border-radius: 12px;
            border: 1px solid #4a4a6a;
            height: 100%; 
            display: flex;
            flex-direction: column;
        }
        .description-box h3 {
            margin-top: 0;
            color: #9bf6ff; 
            font-size: 1.3em; 
            margin-bottom: 15px;
            border-bottom: 1px solid #4a4a6a;
            padding-bottom: 12px;
            text-align: center;
        }

        #alert-section {
            background-color: #5c2525; 
            color: #ffcaca;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #a84f4f;
        }
        #alert-section strong {
            color: #ffefef;
            display: block; 
            margin-bottom: 5px;
        }
        #alert-section.hidden {
            display: none;
        }
        #alert-text ul {
            margin: 0;
            padding-left: 20px; 
        }
        #alert-text li {
            margin-bottom: 3px;
        }


        #quick-vibe-check {
            font-size: 1.0em; 
            color: #b0e0e6; 
            text-align: center; 
            margin-bottom: 15px; 
            padding: 12px;
            background-color: #1e1e36;
            border-radius: 6px;
            line-height: 1.5;
        }
         #quick-vibe-check h3 { 
            font-size: 1.1em; 
            color: #b0e0e6; 
            margin-top: 0;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom-style: dashed;
            border-bottom-width: 1px;
            border-color: #4a4a6a;
            text-align: center; 
        }
        .vibe-emoji {
            font-size: 1.5em; 
            display: block; 
            margin-bottom: 5px;
        }
        .vibe-persona { 
            font-weight: bold;
            color: #c0d0e0; 
            display: block;
            margin-bottom: 5px;
            font-size: 1.05em;
        }
        .vibe-outcome { 
            font-style: italic;
            font-size: 0.95em;
        }


        .profile-section {
            margin-bottom: 15px; 
            padding-bottom: 10px;
            border-bottom: 1px dashed #3a3a5a; 
        }
        .profile-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .profile-section strong { 
            color: #d0d0d0; 
            font-weight: 600;
            display: block; 
            margin-bottom: 5px; 
            font-size: 1.05em;
        }
        .profile-section .section-emoji { 
            margin-right: 8px;
            font-size: 1.1em;
        }
        .profile-section span { 
            color: #b0b0b0; 
            font-size: 0.95em;
            line-height: 1.55; 
            text-align: left; 
        }
        .positive-spin { 
            color: #a6ffcb; 
            font-style: italic;
            display: block; 
            margin-top: 4px;
            font-size: 0.9em;
        }

        /* AI Character Trait Display */
        #ai-character-trait {
            text-align: center;
            margin-bottom: 20px; 
            padding: 15px;
            background-color: #1e1e36;
            border-radius: 8px;
        }
        #trait-icon {
            font-size: 2.8em; 
            display: block;
            margin-bottom: 10px;
        }
        #trait-tags-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        .trait-tag {
            color: #e0e0e0;
            padding: 5px 12px;
            border-radius: 15px; 
            font-size: 0.85em;
            border: 1px solid #4a4a6a;
        }
         .trait-tag.positive { background-color: #2a5c3d; border-color: #38761d; color: #d9ead3;}
         .trait-tag.negative { background-color: #702828; border-color: #990000; color: #f4cccc;}
         .trait-tag.neutral { background-color: #33334f; border-color: #4a4a6a; color: #b0b0b0;}
         .trait-tag.critical-warning { background-color: #ff6b6b; color: #1a1a2e; font-weight: bold; border-color: #e06666;}


        /* Styles for Rendered Markdown Guide */
        .tips-guide-container {
            background-color: #24243e;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 25px 35px;
            border: 1px solid #3a3a5a;
            margin-top: 30px; 
            color: #e0e0e0;
        }
        .tips-guide-container.hidden { 
            display: none;
        }
        #tips-guide-content h1, #tips-guide-content h2, #tips-guide-content h3 { 
            color: #9bf6ff;
            border-bottom: 1px solid #4a4a6a;
            padding-bottom: 8px;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        #tips-guide-content h1 { font-size: 1.6em; text-align: center;}
        #tips-guide-content h2 { font-size: 1.4em; }
        #tips-guide-content h3 { font-size: 1.2em; }
        #tips-guide-content p {
            margin-bottom: 12px;
            line-height: 1.7;
            color: #c5c6c7;
        }
        #tips-guide-content ul, #tips-guide-content ol {
            margin-left: 0px; 
            margin-bottom: 15px;
            padding-left: 25px; 
        }
        #tips-guide-content li {
            margin-bottom: 8px;
        }
        #tips-guide-content strong { 
            color: #e0e0e0;
            font-weight: 600;
        }
        #tips-guide-content code { 
            background-color: #1e1e36;
            color: #ffcaca;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        #tips-guide-content pre { 
            background-color: #1e1e36;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid #3a3a5a;
        }
        #tips-guide-content pre code {
            background-color: transparent;
            padding: 0;
            font-size: 0.9em;
        }
        /* Specific styling for the jump link */
        #tips-guide-content p.jump-to-troubleshooting a { 
            color: #ffb74d !important; /* Orange color, !important to override general a if needed */
            text-decoration: none;
            font-weight: 500;
        }
        #tips-guide-content p.jump-to-troubleshooting a:hover {
            text-decoration: underline;
            color: #ffa726 !important; 
        }
        /* General link styling within the guide (if any other links are added) */
        #tips-guide-content a {
            color: #87CEFA; 
            text-decoration: none;
        }
        #tips-guide-content a:hover {
            text-decoration: underline;
        }

        /* Table styles for Troubleshooting */
        #tips-guide-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 20px;
            font-size: 0.9em; 
        }
        #tips-guide-content th, #tips-guide-content td {
            border: 1px solid #4a4a6a !important; /* Ensure borders are visible */
            padding: 10px 12px;
            text-align: left;
            vertical-align: top;
        }
        #tips-guide-content th {
            background-color: #33334f !important; /* Ensure header bg */
            color: #9bf6ff;
            font-weight: 600;
        }
        #tips-guide-content td ul { 
            margin: 5px 0 0 0;
            padding-left: 18px;
        }
         #tips-guide-content td ul li {
            margin-bottom: 4px;
        }


         @media (max-width: 900px) { 
            .main-container {
                flex-direction: column;
                max-width: 700px; 
            }
            .controls-column, .profile-column {
                max-width: 100%; 
            }
            .profile-column {
                 margin-top: 30px; 
            }
        }
         @media (max-width: 600px) {
            h1 { font-size: 1.6em; }
            .main-label { font-size: 1em; }
            .description-box h3 { font-size: 1.2em; }
            .profile-section strong { font-size: 1em; }
            .profile-section span { font-size: 0.9em; }
            #ai-character-trait { margin-bottom: 15px; }
            #trait-icon { font-size: 2.2em; }
            .trait-tag { font-size: 0.8em; padding: 3px 8px;}
            .numerical-value-box { width: 70px; font-size: 0.9em;}
            #quick-vibe-check { font-size: 0.95em;} 
            .tips-guide-container h1 { font-size: 1.4em; }
            .tips-guide-container h2 { font-size: 1.2em; }
            .tips-guide-container h3 { font-size: 1.1em; }
            #tips-guide-content th, #tips-guide-content td { padding: 6px 8px; font-size: 0.85em; } 
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="page-wrapper"> 
        <h1><span role="img" aria-label="Robot">🤖</span> Kyle's DreamJourney Tweaker <span role="img" aria-label="Robot">🤖</span></h1>
        <p class="disclaimer-note">Some models may vary and settings may have to be tweaked between models. Experiment to find what you like, or even adjust mid roleplay to change up the roleplay a bit!</p>
        
        <div class="main-container">
            <div class="controls-column">
                <div class="controls">
                    <div class="control-group">
                        <div class="label-line">
                            <span class="main-label">Temperature</span>
                            <span id="temp-qualitative-text" class="qualitative-value">Balanced</span>
                        </div>
                        <input type="range" id="temp-slider" min="0.1" max="2.0" step="0.01" value="0.8">
                        <div class="numerical-value-box" id="temp-numerical-container"><span id="temp-numerical-value">0.80</span></div>
                        <div class="slider-ends">
                            <span>Predictable</span> <span>Creative</span>
                        </div>
                        <p class="setting-description">Controls response creativity/randomness. Lower (0.1-0.7) is predictable. Recommended: 0.7-1.2 for balance. Higher (>1.2) is very creative/surprising.</p> 
                    </div>
                    <div class="control-group">
                         <div class="label-line">
                            <span class="main-label">Repetition Penalty</span>
                            <span id="repPen-qualitative-text" class="qualitative-value">Balanced</span>
                        </div>
                        <input type="range" id="repPen-slider" min="1.0" max="2.0" step="0.01" value="1.08">
                        <div class="numerical-value-box" id="repPen-numerical-container"><span id="repPen-numerical-value">1.08</span></div>
                         <div class="slider-ends">
                            <span>Disabled (1.0)</span> 
                            <span>Strongly Avoids (2.0)</span>
                        </div>
                         <p class="setting-description">Discourages repeating words. 1.0 is neutral. Recommended: 1.0-1.4 for balanced control. Higher (>1.7) can degrade quality.</p> 
                    </div>
                    <div class="control-group">
                         <div class="label-line">
                            <span class="main-label">Min P</span>
                            <span id="minP-qualitative-text" class="qualitative-value">Balanced</span>
                        </div>
                        <input type="range" id="minP-slider" min="0.0" max="1.0" step="0.001" value="0.06">
                        <div class="numerical-value-box" id="minP-numerical-container"><span id="minP-numerical-value">0.06</span></div> 
                         <div class="slider-ends">
                            <span>Permissive (0.0)</span>
                            <span>Very Strict (1.0)</span>
                        </div>
                        <p class="setting-description">Filters unlikely words. Higher values are more restrictive. Recommended: 0.04-0.1. Set to 0 to disable.</p>
                    </div>
                </div>
                <div class="action-buttons"> 
                    <button id="reset-button">Reset to Defaults</button>
                    <button id="toggle-guide-button">AI Troubles? Show/Hide Guide</button> 
                </div>
            </div>

            <div class="profile-column">
                <div class="description-box">
                    <h3>Roleplay & Response Profile</h3>
                    <div id="alert-section" class="hidden">
                        <strong>Potential Issue Alert:</strong>
                        <div id="alert-text"></div> 
                    </div>

                    <div id="ai-character-trait"> 
                        <span id="trait-icon" role="img" aria-label="Trait Icon">⚖️</span>
                        <div id="trait-tags-container">
                            {/* Tags injected by JS */}
                        </div>
                    </div>
                    
                    <div id="quick-vibe-check">
                        <h3>Vibe Check:</h3>
                        <span class="vibe-emoji" role="img" aria-label="Vibe Emoji">🤔</span>
                        <div>
                            <span class="vibe-persona">The Balanced Storyteller...</span>
                            <span class="vibe-outcome">aims for engaging and coherent roleplay.</span>
                        </div>
                    </div>
                                    
                    <div class="profile-section"><strong><span class="section-emoji" role="img" aria-label="Idea Pool">💡</span> Variance (Idea Pool):</strong> <span id="variance-text">Moderate</span></div>
                    <div class="profile-section"><strong><span class="section-emoji" role="img" aria-label="Focus">🎯</span> Coherence & Focus (Idea Selection):</strong> <span id="coherence-text">Good</span></div>
                    <div class="profile-section"><strong><span class="section-emoji" role="img" aria-label="Guide">🗺️</span> Prompt Adherence (Following the Scene):</strong> <span id="adherence-text">Balanced</span></div>
                    <div class="profile-section"><strong><span class="section-emoji" role="img" aria-label="Dialogue">💬</span> Word Choice & Tone (Dialogue Polish):</strong> <span id="repetition-text">Natural</span></div>
                </div>
            </div>
        </div>

        <div id="tips-guide-container" class="tips-guide-container hidden"> 
            </div>
    </div>

    <script type="text/template" id="markdown-template">
# Kyle's DJ AI Setting Tips & Troubleshooting Guide

Welcome, Dreamjourneyer! Understanding how Temperature, Min P, and Repetition Penalty work together can greatly enhance your AI roleplaying experience. This guide offers some tips and troubleshooting advice using the "AI Chef" analogy. Think of it like tuning an instrument or seasoning a dish – small adjustments can make a big difference!

<p class="jump-to-troubleshooting"><a href="#troubleshooting-section-anchor">Having Issues? Jump to Troubleshooting Tips 👇</a></p>

## The Core Settings: The AI Chef Analogy 🍳🤖

Imagine your AI is a creative chef preparing a dish (the response):

* **Temperature: The "Adventure" Dial 🔥**
    * **What it is:** Controls how risky or creative the chef is with ingredients (words/ideas).
    * **Low Temp (e.g., 0.1-0.7):** The chef sticks to classic, well-known recipes. The dish is predictable and focused.
    * **Medium Temp (e.g., 0.7-1.2 - Recommended):** The chef is inspired, using reliable recipes but adding a creative twist. Balanced and engaging.
    * **High Temp (e.g., >1.2):** A culinary daredevil! Expect exotic, unexpected ingredients. Could be brilliant or bizarre!

* **Min P: The "Quality Control" Inspector 🧐**
    * **What it is:** After the chef (Temperature) brainstorms ingredients, Min P sets a minimum "acceptability" score (probability). Ingredients below this are discarded.
    * **Low Min P (e.g., 0.0-0.04):** Very lenient inspector, most ingredients pass, even if questionable.
    * **Medium Min P (e.g., 0.04-0.1 - Recommended):** Good judgment, discards unsuitable ingredients but allows quality options.
    * **High Min P (e.g., >0.1):** Extremely strict, only "safest" ingredients. Too high, and the chef has nothing to cook with!

* **Repetition Penalty: The "Variety" Rule 🔄**
    * **What it is:** Tells the chef how much to avoid using the same ingredient/technique repeatedly (1.0 is neutral/disabled).
    * **Disabled/Low (1.0):** Chef doesn't mind reusing favorite ingredients. Dish might have recurring flavors.
    * **Medium (e.g., 1.01-1.4 - Recommended):** Chef varies ingredients to keep the dish interesting.
    * **High (e.g., >1.4):** Chef is *obsessed* with novelty, sometimes using strange substitutes or making the dish taste forced. Too high (>1.7) can lead to unpalatable results.

## General Advice for Your Culinary AI Adventure

* **Start with Defaults:** Use the "Reset to Defaults" button (Temp: 0.8, Min P: 0.06, Rep Pen: 1.08) as a good baseline.
* **One Knob at a Time:** Adjust one setting at a time to clearly see its effect.
* **Small Increments:** Small changes can have big impacts.
* **Context Matters:** "Perfect" settings change with character, scene, or style. Tweak mid-RP!
* **Model Differences:** Remember the disclaimer! Different AI models respond differently. Use this Shaper as a guide, but trust your experience.

---
<h2 id="troubleshooting-section-anchor">Common Issues & Troubleshooting Tips</h2>

Here are some common scenarios and simplified fixes. The "Kyle's DJ AI Setting Playground" tool helps visualize these interactions.

| Problem                                                      | Primary Suspect(s)                                  | Quick Fixes                                                                                                                                                              |
| :----------------------------------------------------------- | :-------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **AI is too repetitive or looping.** | Repetition Penalty too low (especially 1.0).              | • Gradually increase **Repetition Penalty** (e.g., to 1.05, 1.1, 1.15).<br />• If Temp is very low (<0.5), also slightly increase **Temperature**.                                                     |
| **AI is talking nonsense/gibberish, or very off-topic.** | Temperature too high, AND/OR Min P too low.         | • Slightly decrease **Temperature**.<br />• If still an issue, slightly increase **Min P**.<br />• Avoid Temp >1.7 with Min P <0.03 for coherence.                               |
| **AI is too boring/predictable, lacks creativity.** | Temperature too low, AND/OR Min P too high.         | • Gradually increase **Temperature**.<br />• If Temp is moderate, try slightly decreasing **Min P**.<br />• Ensure Repetition Penalty isn't too high (>1.6).                     |
| **AI isn't following prompt well / poor adherence.** | Temperature too high, OR Min P too low.             | • Decrease **Temperature**.<br />• Slightly increase **Min P**.<br />• If Rep Pen is very high (>1.7) and prompt needs repeated keywords, consider lowering Rep Pen.            |
| **AI responses are too short / stops mid-thought.** | Min P too high, OR very low Temp + high Min P.      | • Significantly decrease **Min P**.<br />• If Temp is very low (<0.4), also increase **Temperature** a bit.<br />• Check if Rep Pen is extremely high (>1.8).                   |
| **AI's language feels forced, unnatural, or uses weird words.** | Repetition Penalty is too high.                     | • Decrease **Repetition Penalty** (e.g., from 1.8 towards 1.4).                                                                                                          |

Happy Shaping, and may your AI Chef cook up some amazing stories!
    </script>
    <script>
        // Main UI script (sliders, profile updates, etc.)
        const tempSlider = document.getElementById('temp-slider');
        const minPSlider = document.getElementById('minP-slider');
        const repPenSlider = document.getElementById('repPen-slider');
        const resetButton = document.getElementById('reset-button');
        const toggleGuideButton = document.getElementById('toggle-guide-button'); 
        
        const tempQualitativeText = document.getElementById('temp-qualitative-text');
        const tempNumericalValue = document.getElementById('temp-numerical-value');
        const tempNumericalContainer = document.getElementById('temp-numerical-container'); 
        
        const minPQualitativeText = document.getElementById('minP-qualitative-text');
        const minPNumericalContainer = document.getElementById('minP-numerical-container');
        const minPNumericalValue = document.getElementById('minP-numerical-value');

        const repPenQualitativeText = document.getElementById('repPen-qualitative-text');
        const repPenNumericalContainer = document.getElementById('repPen-numerical-container');
        const repPenNumericalValue = document.getElementById('repPen-numerical-value');

        const traitIconElement = document.getElementById('trait-icon'); 
        const traitTagsContainerElement = document.getElementById('trait-tags-container');

        const quickVibeCheckElement = document.getElementById('quick-vibe-check'); 

        const alertSection = document.getElementById('alert-section');
        const alertText = document.getElementById('alert-text'); 
        const varianceText = document.getElementById('variance-text');
        const coherenceText = document.getElementById('coherence-text');
        const adherenceText = document.getElementById('adherence-text');
        const repetitionText = document.getElementById('repetition-text');
        
        const guideContainerDiv = document.getElementById('tips-guide-container'); 

        const tempEffectiveMinPPlotDomain = [0.0, 0.2]; 

        const defaultSettings = {
            temp: 0.8,
            minP: 0.06,
            repPen: 1.08
        };

        const recRanges = {
            temp: { low: 0.7, high: 1.2 },
            minP: { low: 0.04, high: 0.1 },
            repPen: { low: 1.0, high: 1.4 } 
        };

        function applyDefaults() {
            tempSlider.value = defaultSettings.temp;
            minPSlider.value = defaultSettings.minP;
            repPenSlider.value = defaultSettings.repPen;
            updateUI();
        }

        function updateUI() {
            const temp = parseFloat(tempSlider.value);
            const minP = parseFloat(minPSlider.value);
            const repPen = parseFloat(repPenSlider.value);

            tempNumericalValue.textContent = temp.toFixed(2);
            minPNumericalValue.textContent = minP.toFixed(2); 
            repPenNumericalValue.textContent = repPen.toFixed(2);

            // --- Qualitative Labels & Warnings for Sliders ---
            tempNumericalContainer.classList.remove('recommendation-warning', 'critical-warning'); 
            if (temp < recRanges.temp.low || temp > recRanges.temp.high) {
                tempNumericalContainer.classList.add('recommendation-warning');
            }
            if (temp < 0.4) tempQualitativeText.textContent = "Very Rigid (XLow)"; 
            else if (temp < 0.7) tempQualitativeText.textContent = "Predictable (Low)";
            else if (temp <= 0.9) tempQualitativeText.textContent = "Slightly Predictable (Rec.)";
            else if (temp <= 1.2) tempQualitativeText.textContent = "Balanced (Rec.)";
            else if (temp <= 1.6) tempQualitativeText.textContent = "Creative";
            else tempQualitativeText.textContent = "Very Creative (High)";

            let minPCriticalWarningThreshold = 0.25; 
            if (temp <= 0.5) { minPCriticalWarningThreshold = 0.5; } 
            else if (temp > 0.5 && temp <= 1.2) { minPCriticalWarningThreshold = 0.25; } 
            else { minPCriticalWarningThreshold = 0.15; } 
            
            minPNumericalContainer.classList.remove('recommendation-warning', 'critical-warning');
            if (minP > minPCriticalWarningThreshold || minP > 0.2) {
                 minPNumericalContainer.classList.add('critical-warning');
            } else if (minP < recRanges.minP.low || minP > recRanges.minP.high) {
                minPNumericalContainer.classList.add('recommendation-warning');
            }
            
            if (minP < 0.04) minPQualitativeText.textContent = "Very Permissive (Low)";
            else if (minP <= 0.07) minPQualitativeText.textContent = "Permissive (Rec.)";
            else if (minP <= 0.1) minPQualitativeText.textContent = "Balanced (Rec.)";
            else if (minP <= 0.15) minPQualitativeText.textContent = "Slightly Strict";
            else if (minP <= minPCriticalWarningThreshold && minP <= 0.2) minPQualitativeText.textContent = "Strict"; 
            else minPQualitativeText.textContent = "Very Strict (High)";
            
            const repPenCriticalWarningThreshold = 1.7; 
            repPenNumericalContainer.classList.remove('recommendation-warning', 'critical-warning');
            if (repPen > repPenCriticalWarningThreshold) { 
                repPenNumericalContainer.classList.add('critical-warning');
            } else if (repPen > recRanges.repPen.high) { 
                 if (repPen !== 1.0) { 
                    repPenNumericalContainer.classList.add('recommendation-warning');
                 }
            }

            if (repPen === 1.0) repPenQualitativeText.textContent = "Disabled / Neutral";
            else if (repPen <= 1.15) repPenQualitativeText.textContent = "Balanced Control (Rec.)"; 
            else if (repPen <= 1.4) repPenQualitativeText.textContent = "Reduces Moderately (Rec.)";
            else if (repPen <= repPenCriticalWarningThreshold) repPenQualitativeText.textContent = "Avoids Strongly"; 
            else repPenQualitativeText.textContent = "Extremely Avoidant (High)";

            // --- Enhanced Alert Section ---
            let alertMessages = [];
            if (temp < 0.3 && minP < 0.02) { 
                alertMessages.push("Very low Temperature + very low Min P: Responses may become extremely dull, repetitive, overly simplistic, or get stuck in short loops. The AI has few ideas and no filter.");
            } else if (temp < 0.5 && minP > 0.3) {
                alertMessages.push("Very low Temperature + high Min P: May result in extremely short, highly repetitive, or even no responses. Creativity is severely stifled.");
            } else if (temp < 0.6 && minP > 0.15 && minP > recRanges.minP.high) { 
                 alertMessages.push("Low Temperature + stricter Min P: Can limit creative options and lead to brief, overly focused replies.");
            }
            if (temp > 1.7 && minP < 0.03) {
                alertMessages.push("Extremely high Temperature + very low Min P: Significantly increases the chance of nonsensical, off-topic, or highly chaotic and unpredictable responses.");
            } else if (temp > 1.5 && minP < 0.05) {
                 alertMessages.push("High Temperature + permissive Min P: Can make responses less focused, more random, and potentially less coherent.");
            }
            if (repPenNumericalContainer.classList.contains('critical-warning')) { 
                 if (repPen > 1.8) { 
                    alertMessages.push("Extremely high Repetition Penalty (>1.8): May make language sound unnatural, robotic, or force the use of very obscure words.");
                 } else if (repPen > repPenCriticalWarningThreshold) { 
                    alertMessages.push("High Repetition Penalty (>" + repPenCriticalWarningThreshold.toFixed(1) + "): Can degrade response quality, making language feel forced or unnatural.");
                 }
            }
            if (repPen > 1.6 && temp < 0.8) { 
                 alertMessages.push("High Repetition Penalty + low Temperature: Might feel overly restrictive and make it hard for the AI to form natural sentences.");
            }
            if (minPNumericalContainer.classList.contains('critical-warning')) { 
                if (minP > 0.4) { 
                    alertMessages.push("Very high Min P (>0.4): Will severely filter word choices, likely breaking response generation or leading to extremely truncated outputs.");
                } else if (minP > 0.2 && !alertMessages.some(msg => msg.includes("Min P") && msg.includes("Temperature"))) { 
                    alertMessages.push("High Min P (>0.2): Can significantly restrict word choices, potentially impacting natural flow.");
                }
            }

            if (alertMessages.length > 0) {
                const uniqueAlertMessages = [...new Set(alertMessages)];
                alertText.innerHTML = "<ul><li>" + uniqueAlertMessages.join("</li><li>") + "</li></ul>";
                alertSection.classList.remove('hidden');
            } else {
                alertSection.classList.add('hidden');
            }
            
            // --- AI Character Trait Display ---
            let currentTraitIcon = "⚖️"; 
            let currentTraitTags = [];

            if (alertMessages.length > 0) {
                currentTraitIcon = "⚠️";
                currentTraitTags.push({text: "Extreme Settings!", type: "critical-warning"});
                currentTraitTags.push({text: "See Alerts Above", type: "critical-warning"});
            } else {
                if (temp > 1.7) { currentTraitIcon = "🔥"; currentTraitTags.push({text: "Wildly Creative", type: "positive"}); currentTraitTags.push({text: "Highly Unpredictable", type: "neutral"});}
                else if (temp > 1.2) { currentTraitIcon = "✨"; currentTraitTags.push({text: "Creative Spark", type: "positive"}); }
                else if (temp < 0.4) { currentTraitIcon = "🧊"; currentTraitTags.push({text: "Very Rigid", type: "negative"}); currentTraitTags.push({text: "Deterministic", type: "neutral"});}
                else if (temp < 0.7) { currentTraitIcon = "🧐"; currentTraitTags.push({text: "Predictable", type: "neutral"}); }
                else { currentTraitTags.push({text: "Balanced Ideas", type: "neutral"}); }

                let minPEffectiveThresholdStrict = 0.12 + (temp - 0.8) * 0.05; 
                let minPEffectiveThresholdExtreme = 0.2 + (temp - 0.8) * 0.1;

                if (minP > Math.max(0.3, minPEffectiveThresholdExtreme)) { currentTraitIcon = (currentTraitIcon === "⚖️" || currentTraitIcon === "⚠️" ? "🚧" : currentTraitIcon) ; currentTraitTags.push({text: "Extreme Filter", type: "negative"}); currentTraitTags.push({text: "Risks No Output", type: "negative"});}
                else if (minP > Math.max(0.15, minPEffectiveThresholdStrict)) { currentTraitTags.push({text: "Strict Filter", type: "negative"}); }
                else if (minP < 0.03) { currentTraitTags.push({text: "Very Loose Filter", type: "neutral"}); }
                else { currentTraitTags.push({text: "Moderate Filter", type: "neutral"});}
                
                if (repPen > 1.7) { currentTraitTags.push({text: "Forced Novelty", type: "negative"}); }
                else if (repPen > 1.4) { currentTraitTags.push({text: "Varied Phrasing", type: "positive"});}
                else if (repPen === 1.0 ) { currentTraitTags.push({text: "Allows Repetition", type: "neutral"});}
                else { currentTraitTags.push({text: "Reduces Repetition", type: "neutral"});}

                if (currentTraitTags.length === 0 || (currentTraitTags.length === 3 && currentTraitTags.every(t=>t.type === 'neutral'))) { 
                    currentTraitTags = [{text: "Balanced Overall", type: "neutral"}]; 
                }
            }
            traitIconElement.textContent = currentTraitIcon;
            traitTagsContainerElement.innerHTML = currentTraitTags.slice(0, 3).map(tag => `<span class="trait-tag ${tag.type}">${tag.text}</span>`).join('');


            // --- Quick Vibe Check (Persona-based) ---
            let vibePersona = "";
            let vibeOutcome = "";
            let vibeEmoji = "🤔"; 

            if (alertMessages.length > 0) {
                vibeEmoji = "⚠️"; 
                vibePersona = "The Overwhelmed AI";
                vibeOutcome = "Is struggling with these extreme settings! Check the alerts above for potential issues like broken responses or unexpected chaos.";
            } else if (temp < 0.4 && minP < 0.03) { 
                 vibePersona = "The Stuck Record"; vibeOutcome = "Might say very little, or the same simple things over and over. Very rigid."; vibeEmoji = "🧱";
            } else if (temp < 0.5 && minP > 0.2) { vibePersona = "The Silent Planner"; vibeOutcome = "Is thinking very hard but might not say much due to strict idea filtering. Expect short or no replies."; vibeEmoji = "🤫";}
            else if (temp > 1.6 && minP < 0.03) { vibePersona = "The Wild Brainstormer"; vibeOutcome = "Is throwing out tons of unpredictable ideas! Expect a chaotic but potentially very novel experience."; vibeEmoji = "🤪";}
            else if (temp > 1.3 && minP < 0.05) { vibePersona = "The Adventurous Explorer"; vibeOutcome = "Loves to explore novel ideas with a relaxed filter. Expect diverse and surprising turns."; vibeEmoji = "🗺️";}
            else if (temp < 0.7 && minP > 0.12) { vibePersona = "The Precise Scholar"; vibeOutcome = "Delivers focused, logical, and carefully chosen words. Very controlled."; vibeEmoji = "🧐";}
            else if (temp >= 0.7 && temp <= 1.2 && minP >= 0.04 && minP <= 0.1) { vibePersona = "The Engaging Collaborator"; vibeOutcome = "Aims for a great balance of creativity and coherence. Ideal for most roleplay!"; vibeEmoji = "👍";}
            else { vibePersona = "The Balanced Storyteller"; vibeOutcome = "Offers a mix of predictability and creativity, generally staying on track."; vibeEmoji = "⚖️";} 
            
            if (alertMessages.length === 0 && repPen > 1.5) {
                 if (repPen > 1.7) vibeOutcome += " Dialogue will be *forced* to be unique, possibly sounding unnatural.";
                 else vibeOutcome += " Dialogue will be actively varied, sometimes sounding a bit formal.";
            } else if (alertMessages.length === 0 && repPen === 1.0 && temp <=1.2) {
                vibeOutcome += " Natural dialogue repetition is likely.";
            }
            
            quickVibeCheckElement.innerHTML = `<h3>Vibe Check:</h3><span class="vibe-emoji" role="img" aria-label="Vibe Emoji">${vibeEmoji}</span><div><span class="vibe-persona">${vibePersona}</span><span class="vibe-outcome">${vibeOutcome}</span></div>`;

            // --- Detailed Profile Sections (More Reactive to Extremes, direct language) ---
            let varianceDesc = ""; 
            if (temp > 1.8) varianceDesc = "<span class='section-emoji'>💥</span>Off the Charts: Expect extremely random and novel outputs. The AI is basically freestyling. <span class='positive-spin'>Perfect for pure brainstorming or maximum surprise!</span>";
            else if (temp > 1.5) varianceDesc = "<span class='section-emoji'>🔥</span>Very High: Highly diverse and surprising responses. The AI will explore many unusual paths. <span class='positive-spin'>Great for breaking creative ruts.</span>";
            else if (temp > 1.2) varianceDesc = "<span class='section-emoji'>✨</span>High: Responses will often be surprising and different. Good for unexpected plot twists.";
            else if (temp >= 0.7) varianceDesc = "<span class='section-emoji'>⚖️</span>Moderate: A good mix of consistency and new ideas. Keeps things interesting but generally on track.";
            else if (temp >= 0.4) varianceDesc = "<span class='section-emoji'>🧐</span>Low: Expect very similar and predictable responses. Good for strict consistency, little surprise.";
            else varianceDesc = "<span class='section-emoji'>🧊</span>Extremely Low: Responses will be almost identical and highly deterministic. Can feel robotic or stuck. <span class='positive-spin'>Useful for very specific, controlled outputs if it doesn't get stuck.</span>";
            varianceText.innerHTML = varianceDesc;

            let coherenceDesc = ""; 
            if (minP > 0.5) coherenceDesc = "<span class='section-emoji'>🚫</span>Critically Low: Min P is so high it's likely filtering out almost all words, leading to broken, nonsensical, or no responses at all.";
            else if (temp > 1.5 && minP < 0.03) coherenceDesc = "<span class='section-emoji'>🤪</span>Very Low: Extreme creativity and virtually no filter mean a high chance of nonsensical, random, or completely off-topic outputs. Expect chaos!";
            else if (temp > 1.2 && minP < 0.05) coherenceDesc = "<span class='section-emoji'>🤯</span>Lower: With high creativity and a very loose filter, responses might often drift, become illogical, or lose the plot more easily.";
            else if (temp < 0.4 && minP < 0.03) coherenceDesc = "<span class='section-emoji'>🧱</span>Rigidly Focused & Potentially Stuck: While technically coherent on its narrow path, it may get stuck in loops or produce overly simplistic, repetitive text.";
            else if (temp < 0.5 && minP > 0.15) coherenceDesc = "<span class='section-emoji'>🚧</span>Artificially Constrained: May seem coherent but could be very short or fail due to extreme filtering. Output might feel 'strangled'.";
            else if (temp < 0.7 && minP > 0.1) coherenceDesc = "<span class='section-emoji'>🎯</span>Very High: Responses should be very logical, focused, and directly relevant. Unlikely to go off-topic.";
            else if (minP > 0.2 && temp > 1.2) coherenceDesc = "<span class='section-emoji'>⁉️</span>Potentially Conflicting: High creativity clashes with strict filtering, which may produce sparse, odd, or short results.";
            else coherenceDesc = "<span class='section-emoji'>✅</span>Good: Generally sensible and stays on topic. Reliable for storytelling and consistent character interactions.";
            if (repPen > 1.6 && !(temp > 1.2 && minP < 0.05) ) { 
                 coherenceDesc += " (Note: Very high Repetition Penalty can also make responses feel less natural or coherent due to forced word choices.)"
            }
            coherenceText.innerHTML = coherenceDesc;

            let adherenceDesc = ""; 
            if (temp < 0.4 && minP < 0.03) adherenceDesc = "<span class='section-emoji'>⛓️</span>Literal & Potentially Unresponsive: AI will attempt to adhere but may only grasp the most basic interpretation and get stuck.";
            else if (temp < 0.5 && minP > 0.1) adherenceDesc = "<span class='section-emoji'>🤖</span>Extremely Strong: The AI will be rigidly bound to your prompt and character. Almost no creative deviation. Very robotic.";
            else if (temp < 0.7 && minP > 0.08) adherenceDesc = "<span class='section-emoji'>👍</span>Very Strong: The AI will stick closely to your instructions and character details. Little deviation.";
            else if (temp <= 1.0 && minP >= 0.05) adherenceDesc = "<span class='section-emoji'>👌</span>Strong: Follows instructions well, with minor creative interpretations fitting the context.";
            else if (temp > 1.6 || minP < 0.02) adherenceDesc = "<span class='section-emoji'>🎢</span>Extremely Loose: The AI will likely disregard large parts of your prompt, following its own highly random path. <span class='positive-spin'>Can lead to completely unexpected scenarios!</span>";
            else if (temp > 1.2 || minP < 0.04) adherenceDesc = "<span class='section-emoji'>🌬️</span>Loose: Expect free interpretation of your prompt. The AI may deviate significantly. <span class='positive-spin'>Good for letting the AI take the lead.</span>";
            else adherenceDesc = "<span class='section-emoji'>🤝</span>Balanced: Follows your lead but adds its own creative touches to enhance the roleplay.";
            if (repPen > 1.7) adherenceDesc += " (Note: Extreme Repetition Penalty might make it hard for the AI to use specific keywords if your prompt requires them to be repeated.)";
            adherenceText.innerHTML = adherenceDesc;
            
            let repDesc = ""; 
            if (repPen === 1.0) repDesc = "<span class='section-emoji'>💬</span>Neutral: Allows natural repetition. Words/phrases might repeat if common or contextually fitting.";
            else if (repPen <= 1.4) repDesc = "<span class='section-emoji'>🍃</span>Reduced: Gently discourages obvious repetition, making dialogue feel fresher and more varied.";
            else if (repPen <= 1.7) repDesc = "<span class='section-emoji'>✍️</span>Strongly Reduced: Actively avoids repeating words, pushing for more unique vocabulary. <span class='positive-spin'>Can result in more eloquent or distinct character voices.</span>";
            else repDesc = `<span class='section-emoji'>🚫</span>Extremely Reduced: Forces highly unique phrasing. Language might become unnatural or use rare words to avoid any repetition.`;
            repetitionText.innerHTML = repDesc;
        }
        
        document.addEventListener('DOMContentLoaded', (event) => {
            const guideContainerDiv = document.getElementById('tips-guide-container'); 
            const markdownTemplate = document.getElementById('markdown-template'); 
            
            if (guideContainerDiv && markdownTemplate && typeof marked !== 'undefined') { 
                guideContainerDiv.innerHTML = marked.parse(markdownTemplate.textContent); 
            } else if (guideContainerDiv && markdownTemplate) {
                guideContainerDiv.innerHTML = '<h2>Tips & Troubleshooting Guide (Raw Markdown - Marked.js failed to load)</h2><pre>' + markdownTemplate.textContent + '</pre>';
                console.warn("Marked.js library not loaded or an issue occurred. Displaying raw Markdown in #tips-guide-container.");
            }
            
            if(toggleGuideButton) {
                toggleGuideButton.addEventListener('click', () => {
                    if(guideContainerDiv) {
                        guideContainerDiv.classList.toggle('hidden');
                        toggleGuideButton.textContent = guideContainerDiv.classList.contains('hidden') ? "AI Troubles? Show Guide" : "Hide Guide";
                    }
                });
            }
            applyDefaults(); 
        });

        tempSlider.addEventListener('input', updateUI);
        minPSlider.addEventListener('input', updateUI);
        repPenSlider.addEventListener('input', updateUI);
        resetButton.addEventListener('click', applyDefaults);
        
    </script>
</body>
</html>
